name: Analyse m√©moire avec Valgrind

on:
  push:
    branches: [main]
  pull_request:

jobs:
  valgrind:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du d√©p√¥t
        uses: actions/checkout@v4

      - name: ‚úÖ V√©rification des d√©pendances
        run: |
          for cmd in cmake valgrind; do
            if ! command -v $cmd &> /dev/null; then
              echo "‚ùå $cmd is not installed"; exit 1;
            fi
          done

      - name: Installer Valgrind
        run: sudo apt-get update && sudo apt-get install -y valgrind

      - name: Configurer le projet
        run: cmake -B build -DCMAKE_BUILD_TYPE=Debug

      - name: Compiler
        run: cmake --build build

      - name: üö® Ex√©cuter Valgrind sur TestApp
        run: |
          valgrind --leak-check=full --error-exitcode=1 ./build/TestApp
